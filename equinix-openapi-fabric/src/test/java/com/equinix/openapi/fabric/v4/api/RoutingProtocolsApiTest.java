/*
 * Equinix Fabric API v4
 *
 * Contact: api-support@equinix.com
 *
 * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).
 * https://openapi-generator.tech
 * Do not edit the class manually.
 */

package com.equinix.openapi.fabric.v4.api;

import com.equinix.openapi.fabric.ApiException;
import com.equinix.openapi.fabric.v4.api.dto.users.UserResources;
import com.equinix.openapi.fabric.v4.api.dto.users.UsersItem;
import com.equinix.openapi.fabric.v4.model.*;
import org.junit.jupiter.api.AfterAll;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.Disabled;
import org.junit.jupiter.api.Test;

import java.util.UUID;

import static com.equinix.openapi.fabric.v4.api.ConnectionsApiTest.createConnectionFCR2ToPort;
import static com.equinix.openapi.fabric.v4.api.helpers.TokenGenerator.users;
import static com.equinix.openapi.fabric.v4.api.helpers.Apis.routingProtocolsApi;
import static com.equinix.openapi.fabric.v4.api.helpers.Apis.setUserName;
import static java.util.Collections.singletonList;
import static org.junit.jupiter.api.Assertions.assertEquals;

/**
 * API tests for RoutingProtocolsApi
 */
@Disabled
public class RoutingProtocolsApiTest {
    private static final UsersItem.UserName userName = UsersItem.UserName.PANTHERS_FCR;

    public static void removeRoutingInstances(UsersItem.UserName userName) {
        users.get(userName).getUserResources().getRoutingProtocolsUuid().forEach(RoutingProtocolsApiTest::deleteRoutingProtocol);
    }

    @BeforeAll
    public static void setUp() {
        setUserName(userName);
    }

    @AfterAll
    public static void removeResources() {
        removeRoutingInstances(userName);
    }

    /**
     * Successful operation
     */
    @Test
    public void createConnectionRoutingProtocol() throws ApiException {
        Connection connection = createConnectionFCR2ToPort();
        validateRoutingProtocol(userName, connection.getaSide().getAccessPoint().getRouter().getUuid(), connection.getUuid());

        RoutingProtocolBase routingProtocolBase = new RoutingProtocolBase(new RoutingProtocolDirectType()
                .type(RoutingProtocolDirectType.TypeEnum.DIRECT)
                .directIpv4(new DirectConnectionIpv4().equinixIfaceIp(""))
                .directIpv6(new DirectConnectionIpv6().equinixIfaceIp("")));
        RoutingProtocolData routingProtocolData = routingProtocolsApi.createConnectionRoutingProtocol(connection.getUuid(), routingProtocolBase);
    }

//    /**
//     * Successful operation
//     */
//    @Test
//    public void shouldSee202AfterCreateConnectionRoutingProtocolsInBulk() {
//        String connectionId = null;
//        ConnectionRoutingProtocolPostRequest connectionRoutingProtocolPostRequest = null;
//        api.createConnectionRoutingProtocolsInBulk()
//                .connectionIdPath(connectionId)
//                .body(connectionRoutingProtocolPostRequest).execute(r -> r);
//        // TODO: test validations
//    }
//
//    /**
//     * Successful operation
//     */
//    @Test
//    public void shouldSee202AfterDeleteConnectionRoutingProtocolByUuid() {
//        UUID routingProtocolId = null;
//        String connectionId = null;
//        api.deleteConnectionRoutingProtocolByUuid()
//                .routingProtocolIdPath(routingProtocolId)
//                .connectionIdPath(connectionId).execute(r -> r);
//        // TODO: test validations
//    }
//
//    /**
//     * Successful operation
//     */
//    @Test
//    public void shouldSee200AfterGetConnectionRoutingProtocolByUuid() {
//        UUID routingProtocolId = null;
//        String connectionId = null;
//        api.getConnectionRoutingProtocolByUuid()
//                .routingProtocolIdPath(routingProtocolId)
//                .connectionIdPath(connectionId).execute(r -> r);
//        // TODO: test validations
//    }
//
//    /**
//     * Successful operation
//     */
//    @Test
//    public void shouldSee200AfterGetConnectionRoutingProtocols() {
//        String connectionId = null;
//        Integer offset = null;
//        Integer limit = null;
//        api.getConnectionRoutingProtocols()
//                .connectionIdPath(connectionId).execute(r -> r);
//        // TODO: test validations
//    }
//
//    /**
//     * Fabric BGP Action object
//     */
//    @Test
//    public void shouldSee200AfterGetConnectionRoutingProtocolsBgpActionByUuid() {
//        String connectionId = null;
//        UUID routingProtocolId = null;
//        UUID actionId = null;
//        api.getConnectionRoutingProtocolsBgpActionByUuid()
//                .connectionIdPath(connectionId)
//                .routingProtocolIdPath(routingProtocolId)
//                .actionIdPath(actionId).execute(r -> r);
//        // TODO: test validations
//    }
//
//    /**
//     * Fabric Routing Protocol Change object
//     */
//    @Test
//    public void shouldSee200AfterGetConnectionRoutingProtocolsChangeByUuid() {
//        String connectionId = null;
//        UUID routingProtocolId = null;
//        UUID changeId = null;
//        api.getConnectionRoutingProtocolsChangeByUuid()
//                .connectionIdPath(connectionId)
//                .routingProtocolIdPath(routingProtocolId)
//                .changeIdPath(changeId).execute(r -> r);
//        // TODO: test validations
//    }
//
//    /**
//     * Fabric Routing Protocol Change object
//     */
//    @Test
//    public void shouldSee200AfterGetConnectionRoutingProtocolsChanges() {
//        String connectionId = null;
//        UUID routingProtocolId = null;
//        Integer offset = null;
//        Integer limit = null;
//        api.getConnectionRoutingProtocolsChanges()
//                .connectionIdPath(connectionId)
//                .routingProtocolIdPath(routingProtocolId).execute(r -> r);
//        // TODO: test validations
//    }
//
//    /**
//     * Successful operation
//     */
//    @Test
//    public void shouldSee202AfterPatchConnectionRoutingProtocolByUuid() {
//        UUID routingProtocolId = null;
//        String connectionId = null;
//        List<ConnectionChangeOperation> connectionChangeOperation = null;
//        api.patchConnectionRoutingProtocolByUuid()
//                .routingProtocolIdPath(routingProtocolId)
//                .connectionIdPath(connectionId)
//                .body(connectionChangeOperation).execute(r -> r);
//        // TODO: test validations
//    }
//
//    /**
//     * Successful operation
//     */
//    @Test
//    public void shouldSee202AfterPostConnectionRoutingProtocolBgpActionByUuid() {
//        UUID routingProtocolId = null;
//        String connectionId = null;
//        BGPActionRequest bgPActionRequest = null;
//        api.postConnectionRoutingProtocolBgpActionByUuid()
//                .routingProtocolIdPath(routingProtocolId)
//                .connectionIdPath(connectionId)
//                .body(bgPActionRequest).execute(r -> r);
//        // TODO: test validations
//    }
//
//    /**
//     * Successful operation
//     */
//    @Test
//    public void shouldSee200AfterValidateRoutingProtocol() {
//        UUID routerId = null;
//        ValidateRequest validateRequest = null;
//        api.validateRoutingProtocol()
//                .routerIdPath(routerId)
//                .body(validateRequest).execute(r -> r);
//        // TODO: test validations
//    }

    public static void validateRoutingProtocol(UsersItem.UserName userNameType, UUID routeUUID, String connectionUuid) throws ApiException {
        String ip = "192.68.100.100/24";

        ValidateRequest validateRequest = new ValidateRequest().filter(new ValidateRequestFilter()
                .addAndItem(new ValidateRequestFilterAnd()
                        .property("/directIpv4/equinixIfaceIp")
                        .operator(Expression.OperatorEnum.EQUAL.getValue())
                        .values(singletonList(ip)))
                .addAndItem(new ValidateRequestFilterAnd()
                        .property("/connection/uuid")
                        .operator(Expression.OperatorEnum.EQUAL.getValue())
                        .values(singletonList(connectionUuid))));
        routingProtocolsApi.validateRoutingProtocol(routeUUID, validateRequest);

        RoutingProtocolBase a = new RoutingProtocolBase(new RoutingProtocolDirectType()
                .type(RoutingProtocolDirectType.TypeEnum.DIRECT).directIpv4(new DirectConnectionIpv4()
                        .equinixIfaceIp(ip)));

        routingProtocolsApi.createConnectionRoutingProtocolsInBulkWithHttpInfo(connectionUuid, new ConnectionRoutingProtocolPostRequest()
                .data(singletonList(a)));
    }

    public static void deleteRoutingProtocol(UserResources.RoutingProtocolDto routingProtocolDto) {
        try {
            routingProtocolsApi.deleteConnectionRoutingProtocolByUuid(routingProtocolDto.getRoutingInstanceUuid(), String.valueOf(routingProtocolDto.getConnectionUuid()));
            assertEquals(202, routingProtocolsApi.getApiClient().getStatusCode());
        } catch (ApiException e) {
            throw new RuntimeException(e);
        }
    }
}
